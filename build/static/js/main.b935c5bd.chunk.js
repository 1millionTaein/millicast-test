(this.webpackJsonpmillicast=this.webpackJsonpmillicast||[]).push([[0],{43:function(e,n,t){},44:function(e,n,t){},69:function(e,n,t){"use strict";t.r(n);var r=t(0),c=t.n(r),o=t(32),a=t.n(o),s=(t(43),t(44),t(17)),i=t(4),u=t.n(i),d=t(9),l=t(19),f=t(18),p=t.n(f),v="https://director.millicast.com/api";var m,b,g=(m=v,p.a.create(Object.assign({baseURL:m},b))),h=function(e,n,t){var r=p.a.create(Object.assign({baseURL:e},t));return function(e,n){e.interceptors.request.use((function(e){return e.headers.Authorization="Bearer ".concat(n),e}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){return e}),(function(e){return Promise.reject(e)}))}(r,n),r}(v,"fb287fe7ccd14cc439eecf9d5aa7d6c4d71b79aeb3d8354d66c92caeaae9744e"),j="krmxvbmm";var w,O,x=t(38),S=t(33),k="wss://streamevents.millicast.com/ws",y=!1,N=0,R="viewing: ",C="krmxvbmm",T="CEANfN";function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C,t=arguments.length>2?arguments[2]:void 0;if(!w&&e&&n){O=t;var r="".concat(e,"/").concat(n);console.log("*cnt* connect",k),(w=new WebSocket(k)).onmessage=function(e){if(!y)return console.trace("Received handshake response"),y=!0,I(e.data),console.log("Invoking method to watch view count"),void E(w,r);var n;try{n=A(e.data)}catch(p){throw console.error("Failed to parse JSON:",e.data),p}switch(n.type){case 1:if("SubscribeViewerCountResponse"===n.target){var t,c=Object(S.a)(n.arguments);try{for(c.s();!(t=c.n()).done;){var o=t.value,a=o.streamId,s=o.count;a&&(console.log("Viewer count changed. ".concat(a," = ").concat(s)),O&&(O.innerHTML=R+(s.length>1?s:"0"+s)))}}catch(p){c.e(p)}finally{c.f()}}break;case 3:if(n.error)throw console.error("Failed to invoke SubscribeViewerCount method",n.error),new Error(n.error);for(var i=0,u=Object.entries(n.result.streamIdCounts);i<u.length;i++){var d=Object(x.a)(u[i],2),l=d[0],f=d[1];l&&console.log("Initial viewer count of ".concat(l," = ").concat(f))}}},w.onopen=function(e){console.trace("Websocket opened, beginning handshake");P(w,JSON.stringify({protocol:"json",version:1}))}}}function E(e,n){var t={arguments:[[n]],invocationId:(N++).toString(),streamIds:[],target:"SubscribeViewerCount",type:1};P(e,JSON.stringify(t))}function I(e){var n=A(e);if(n.error)throw console.error(n.error),new Error(n.error)}function A(e){return e.endsWith("\x1e")&&(e=e.slice(0,-1)),JSON.parse(e)}function P(e,n){n.endsWith("\x1e")||(n+="\x1e"),console.log("sendSignalRMessage ",n),e.send(n)}var L,J,M,F,V,W,q=t(3),B=function(){var e=Object(r.useRef)(),n=function(){var n=Object(d.a)(u.a.mark((function n(){var t,r,c;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=new RTCPeerConnection({rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"}),n.next=4,navigator.mediaDevices.getUserMedia({video:!0,audio:!0});case 4:r=n.sent,e.current.srcObject=r,console.log(r),r.getTracks().forEach((function(e){console.log("track: ",e),t.addTrack(e,r)})),console.log(e.current.srcObject),c=new WebSocket("".concat(M,"?token=").concat(F)),console.log(c),c.onopen=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 2:n=e.sent,console.log("createOffer Success!"),t.setLocalDescription(n).then((function(){console.log("setLocalDescription Success!");var e={name:"krmxvbmm",sdp:n.sdp,codec:"h264"},t={type:"cmd",transId:1e4*Math.random(),name:"publish",data:e};c.send(JSON.stringify(t))}));case 5:case"end":return e.stop()}}),e)}))),c.addEventListener("message",(function(e){console.log("ws::message",e);var n=JSON.parse(e.data);switch(n.type){case"response":console.log(n);var r=n.data,c=new RTCSessionDescription({type:"answer",sdp:r.sdp+"a=x-google-flag:conference\r\n"});t.setRemoteDescription(c).then((function(e){console.log("setRemoteDescription Success! "),console.log("YOU ARE BROADCASTING!")})).catch((function(e){console.log("setRemoteDescription failed: ",e)}))}})),D("CEANfN","krmxvbmm",document.querySelector(".count"));case 15:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),t=function(){var e=Object(d.a)(u.a.mark((function e(){var t,r,c,o,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.post("/director/publish",{streamName:j});case 2:return t=e.sent,r=t.data,c=r.data,o=c.jwt,a=c.urls,F=o,M=null===a||void 0===a?void 0:a[0],e.next=9,n();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t()}),[]),Object(q.jsxs)(U,{children:[Object(q.jsx)(z,{ref:e,autoPlay:!0,muted:!0}),Object(q.jsx)("div",{className:"count"})]})},U=l.a.div(L||(L=Object(s.a)(["\n  width: 100%;\n  height: 600px;\n"]))),z=l.a.video(J||(J=Object(s.a)(["\n  width: 600px;\n  height: 400px;\n"]))),G=t(37),H=t(1),Y=function(){var e=Object(r.useRef)(),n=function(){var n=Object(d.a)(u.a.mark((function n(){var t,r;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(t=new RTCPeerConnection({iceServers:undefined,rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"})).ontrack=function(n){console.log(n);var t=null===e||void 0===e?void 0:e.current;t&&(t.srcObject=n.streams[0],t.controls=!1)},(r=new WebSocket("".concat(V,"?token=").concat(W))).onopen=Object(d.a)(u.a.mark((function e(){var n,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.addTransceiver&&(n=new MediaStream,t.addTransceiver("audio",{direction:"recvonly",streams:[n]}),t.addTransceiver("video",{direction:"recvonly",streams:[n]})),e.next=3,t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:c=e.sent,console.log("createOffer Success!"),t.setLocalDescription(c).then((function(){console.log("setLocalDescription Success!");var e={type:"cmd",transId:0,name:"view",data:{streamId:"CEANfN/krmxvbmm",sdp:c.sdp}};r.send(JSON.stringify(e))}));case 6:case"end":return e.stop()}}),e)}))),r.addEventListener("message",(function(e){var n=JSON.parse(e.data);switch(console.log(n),n.type){case"response":var r=n.data,c=new RTCSessionDescription({type:"answer",sdp:r.sdp+"a=x-google-flag:conference\r\n"});t.setRemoteDescription(c);break;default:return}}));case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),t=function(){var e=Object(d.a)(u.a.mark((function e(){var t,r,c,o,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.post("/director/subscribe",{streamName:j,streamAccountId:"CEANfN",unauthorizedSubscribe:!0});case 2:return t=e.sent,r=t.data,console.log(r),c=r.data,o=c.jwt,a=c.urls,W=o,V=null===a||void 0===a?void 0:a[0],e.next=10,n();case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t()}),[]),Object(q.jsx)("div",{children:Object(q.jsx)("video",{ref:e,autoPlay:!0})})};var K=function(){return Object(q.jsx)(G.a,{children:Object(q.jsx)("div",{className:"App",children:Object(q.jsxs)(H.c,{children:[Object(q.jsx)(H.a,{exact:!0,path:"/",component:B}),Object(q.jsx)(H.a,{path:"/subscribe",component:Y})]})})})},Q=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,70)).then((function(n){var t=n.getCLS,r=n.getFID,c=n.getFCP,o=n.getLCP,a=n.getTTFB;t(e),r(e),c(e),o(e),a(e)}))};a.a.render(Object(q.jsx)(c.a.StrictMode,{children:Object(q.jsx)(K,{})}),document.getElementById("root")),Q()}},[[69,1,2]]]);
//# sourceMappingURL=main.b935c5bd.chunk.js.map